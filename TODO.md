# Deltaload-New TODO

This file tracks whatâ€™s working, what needs work, and captures parameters and current statistics for the unified delta pipeline.

## Working
- Unified schema (`unified/unified-schema.ts`) with stable IDs and content hashes
- Bookmark normalizer (JSON/JSONL Raindrop/Twitter/GitHub shapes)
- Unified chat normalizer (conversations[] -> chat_message records)
- Delta manifest + snapshot/append modes (`unified/unified-delta.ts`)
- CLI (`unified/cli.ts`) to run normalization + delta
- Verification (`unified/verify.ts`) for schema/dupes/type counts
- Reporting (`unified/report.ts`) JSON + markdown summary (REPORT.md)
- Source fetchers: Raindrop (`bin/fetch-raindrop.ts`), GitHub starred (`bin/fetch-github-stars.ts`), Orchestrator (`bin/fetch-all.ts`)

## Needs Work
- More normalizers: separated_messages, Claude Code tool_results, CSV bookmarks
- Performance: streaming large inputs to reduce memory footprint
- Tests: unit tests for normalizers and delta engine
- CI: type-check + lint + sample verify/report on push
- Optional: compact binary outputs or parquet for large runs
- X/Twitter Grok pipeline: finish timeline fetch and content scraper, guard with credentials + rate limits
- Add `.env` onboarding to `setup-credentials.sh` (write file safety)

## Parameters
- Mode: `snapshot|append` (manifest: `unified/unified-manifest.json`)
- Output dir: default `./unified` or via `--out`
- Record types: `bookmark`, `chat_message` (extensible)
- Hashing: sha256 over canonical core fields
- Sources (env-driven): `RAINDROP_API_KEY`, `GITHUB_TOKEN`, `X_CT0`/`X_AUTH_TOKEN`/`X_KDT`, optional `UNIFIED_CHAT_PATH`

## Commands
- Run (example):
  - `bun unified/cli.ts bookmark:more-bookmarks.jsonl`
  - `bun unified/cli.ts --out ./unified --mode snapshot \
     bookmark:/Users/imac/Desktop/Donkeyv1/context/bookmark/docetl_bookmarkv0/processed_bookmarks_for_docetl.jsonl \
     chat_unified:/Users/imac/Desktop/Donkeyv1/context/chat_history/unified_data/unified_chat_properly_separated_20250613_150354.json`
- Verify: `bun unified/verify.ts ./unified`
- Report: `bun unified/report.ts ./unified` (also writes `unified/REPORT.md`)
- Source fetch:
  - `bun bin/fetch-raindrop.ts`
  - `bun bin/fetch-github-stars.ts`
  - `bun bin/fetch-all.ts` (fetch available + ingest to unified)

## Current Statistics (latest run)
Generated by `bun unified/report.ts ./unified`

```
Params:
- Mode: snapshot
- Runs: 2

Totals:
- Records: 100
- Created_at coverage: 100/100

By Type:
- bookmark: 100

By Source:
- github: 100

Changes (last run):
- unchanged: 100
```
